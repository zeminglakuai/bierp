jQuery(function(){
	var origin_html = $(".queueList").html();
	var origin_goods_img = $("#goods_img").val();
	if(!WebUploader.Uploader.support())throw alert("Web Uploader 不支持您的浏览器！如果你使用的是IE浏览器，请尝试升级 flash 播放器"),
	new Error("WebUploader does not support the browser you are using.");
	n=WebUploader.create({
		pick:{id:"#filePicker",label:"选择图片/QQ截屏粘贴"},
		paste:document.body,
		accept:{title:"Images",extensions:"gif,jpg,jpeg,bmp,png",mimeTypes:"image/*"},
		swf:BASE_URL+"/Uploader.swf",disableGlobalDnd:!0,chunked:!0,
		server:UPLOAD_URL,
		fileNumLimit:1,
		fileSizeLimit:5242880,
		fileSingleSizeLimit:1048576,
		fileVal:'Goods[goods_img]'
		})
	n.onFileQueued=function(e){
			var inner_html = $('<div id="'+e.id+'"><div class="file-panel"><span class="cancel">删除</span></div></div>');
			n.makeThumb(e,function(error,ret){
					if ( error ) {
			            alert('wrong~!');
			        } else {
						inner_html.append($('<img src="'+ret+'">'))
						$(".queueList").empty().append(inner_html);
			        }
			        $(".cancel").click(function(){
						n.reset();
					});
				}
			,300,300)
	}

	n.on('reset', function (){
		//重置框内元素
		$("#goods_img").val(origin_goods_img);
		$(".queueList").empty().html(origin_html);
	})

	n.on('uploadSuccess', function (file, response){
		alert('上传成功');
		$("#goods_img").val(response.content);
	})

	n.onerror=function(e){alert("Eroor: "+e)}

	$(".uploadBtn").click(function(){
		n.upload();
	});

});
